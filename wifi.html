<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>主页-Wifi配置</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="images/icon/favicon.ico">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/metisMenu.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/slicknav.min.css">
    <!-- amchart css -->
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <!-- others css -->
    <link rel="stylesheet" href="css/typography.css">
    <link rel="stylesheet" href="css/default-css.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/responsive.css">
    <!-- modernizr css -->
    <script src="js/modernizr-2.8.3.min.js"></script>
</head>

<body class="body-bg">
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <!-- preloader area start -->
    <div id="preloader">
        <div class="loader"></div>
    </div>
    <!-- preloader area end -->
    <!-- main wrapper start -->
    <div class="horizontal-main-wrapper">
        <!-- main header area start -->
        <!-- main header area end -->
        <!-- header area start -->
        <div class="mainheader-area">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-3  d-none d-lg-block">
                        <div class="horizontal-menu">
                            <nav>
                                <ul id="nav_menu">
                                    <li>
                                        <a href="index.html"><i class="ti-dashboard"></i><span>监测</span></a>
                                    </li>
                                    <li class="active"><a href="wifi.html"><i class="ti-settings"></i> <span>Wifi配置</span></a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <!-- nav and search button -->
                    <!-- mobile_menu -->
                    <div class="col-12 d-block d-lg-none">
                        <div id="mobile_menu"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- header area end -->
        <!-- page title area end -->
        <div class="main-content-inner">
            <div class="container">
                <div class="row">
                    <!-- seo fact area start -->
                    <div class="col-lg-8">
                        <div class="row">
                             <!-- accordion style 5 start -->
                            <div class="col-lg-6 mt-5">
                            </div>
                            <!-- accordion style 5 end -->
                            <!-- accordion style 5 start -->
                            <div class="col-lg-6 mt-5">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title">选择WIFI连接方式 <!--&nbsp; <button type="button" class="btn btn-xs btn-light" id="refresh2"><i class="fa fa-refresh"></i></button>--></h4>                
                                        <div id='myAlert'></div>
                                        <p class="text-muted mb-3">WIFI连接状态: <span id="wifiState"></span></p>
                                        <div id="accordion5" class="according accordion-s2 gradiant-bg">
                                            <div class="card">
                                                <div class="card-header">
                                                    <a class="card-link" data-toggle="collapse" href="#accordion51">普通WIFI上网（家庭）</a>
                                                </div>
                                                <div id="accordion51" class="collapse show" data-parent="#accordion5">
                                                    <form>
                                                        <div class="login-form-body">
                                                            <div class="form-gp">
                                                                <label for="exampleInputEmail1">WIFI名称</label>
                                                                <input type="text" id="wifiname" >
                                                                <i class="fa fa-wifi"></i>
                                                            </div>
                                                            <div class="form-gp">
                                                                <label for="exampleInputPassword1">WIFI密码</label>
                                                                <input type="text" id="wifipwd">
                                                                <i class="ti-lock"></i>
                                                            </div>
                                                            <div class="submit-btn-area">
                                                                <button id="form_submit" type="button" class="fb-login" onclick='setWifi(wifiname.value,wifipwd.value)' >连接 <i class="ti-arrow-right"></i></button>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- accordion style 5 end -->
                </div>
            </div>
        </div>
        <!-- main content area end -->
    </div>
    <!-- main wrapper start -->
    <!-- jquery latest version -->
    <script src="js/jquery-2.2.4.min.js"></script>
    <!-- bootstrap 4 js -->
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/metisMenu.min.js"></script>
    <script src="js/jquery.slimscroll.min.js"></script>
    <script src="js/jquery.slicknav.min.js"></script>

    <!-- start chart js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <!-- start highcharts js -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <!-- start amcharts -->
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="https://www.amcharts.com/lib/3/ammap.js"></script>
    <script src="https://www.amcharts.com/lib/3/maps/js/worldLow.js"></script>
    <script src="https://www.amcharts.com/lib/3/serial.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
    <!-- all line chart activation -->
    <script src="js/line-chart.js"></script>
    <!-- others plugins -->
    <script src="js/plugins.js"></script>
    <script src="js/scripts.js"></script>
			
    <script type="text/javascript">
        var n=5; 
        var myVar;
        //该函数每秒执行一次，共倒数n秒，倒数完成后刷新页面
        function setAlert(){
            var textStr="<div class=\"alert alert-success\" role\"alert\">\
                                <strong>信息已提交，连接中……</strong>";
            textStr+=n.toString();
            textStr+="秒后自动刷新界面。 </div>";         
            document.getElementById("myAlert2").innerHTML = textStr;
            n-=1;
            if(n<=0) {
                clearInterval(myVar);
                location.reload();
            }
        }

        function setWifi(name,pwd) {
            var xmlhttp;
            if (name.length==0)
            {
                document.getElementById("myAlert").innerHTML =  
                " <div class=\"alert alert-warning\" role=\"alert\">\
                     <strong></strong>请输入WIFI信息! </div>"
                return;
            }
             
            if (window.XMLHttpRequest)
            {
            // IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
            xmlhttp=new XMLHttpRequest();
            }
            else
            {
            // IE6, IE5 浏览器执行代码
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
             
            xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState==4 && xmlhttp.status==200){
            // alert(xmlhttp.responseText);
            document.getElementById("wifiState").innerHTML = xmlhttp.responseText;
             }
            }

            var requestString = "/wifi?config=on" + "&name="+name+"&pwd="+pwd;
            xmlhttp.open("POST", requestString, true);
            xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");  
            xmlhttp.send("name="+name+"&pwd="+pwd);

            newPage();
        }

        // 自制弹出的alert窗口
        function newPage(){
            // 加入透明背景
            var body = document.body;
            var backgroundDiv = document.createElement("div");
            backgroundDiv.style.cssText = "left:0;top:0;position:fixed;background:white;opacity:0.95;width:100%;height:100%";
            body.appendChild(backgroundDiv);
            // 加入居中弹出框
            var newDiv = document.createElement("div");
            newDiv.style.cssText = "position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;width:400px;height:200px;background:white;";
            backgroundDiv.appendChild(newDiv);
            // 丰富弹出框内容
            var newAlert = document.createElement("div");
            newAlert.id="myAlert2";
            newDiv.appendChild(newAlert);
            myVar=setInterval(setAlert,1000);
        }
    </script>
</body>

</html>
